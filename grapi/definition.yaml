apiVersion: apiextensions.crossplane.io/v1
kind: CompositeResourceDefinition
metadata:
  name: compositegrappleapis.grsf.grpl.io
  # annotations:
  #   upbound.io/ui-schema: |-
  #     ---
  #     configSections:
  #     - title: Network Info
  #       description: Information about this network fabric
  #       items:
  #       - name: id
  #         controlType: singleInput
  #         type: string
  #         path: ".spec.id"
  #         title: Network ID
  #         description: Network ID that other objects will use to refer (and connect) to this network fabric
  #         default: multik8s-network
  #         validation:
  #         - required: true
  #           customError: Network ID is required.
  #       - name: provider
  #         controlType: singleSelect
  #         path: ".spec.compositionSelector.matchLabels[provider]"
  #         title: Cloud Provider
  #         description: Select which cloud provider this network should be created in.
  #         default: AWS
  #         enum:
  #         - AWS
  #         - GCP
  #         validation:
  #         - required: true
  #           customError: Cloud provider is required.
  #     - title: Cluster Info
  #       description: The cluster used with this network fabric
  #       items:
  #       - name: clusterRef
  #         controlType: singleInput
  #         type: string
  #         path: ".spec.clusterRef.id"
  #         title: Cluster Ref
  #         description: ID of the Cluster object that will use this network fabric
  #         default: multik8s-cluster
  #         validation:
  #         - required: true
  #           customError: Cluster ref is required.
spec:
  claimNames:
    kind: GrappleApi
    plural: grappleapis
    shortNames:
      - api
      - apis
      - grapi
      - grapis
      - grplapi
      - grplapis
      - grappleapi
  group: grsf.grpl.io
  names:
    kind: CompositeGrappleApi
    plural: compositegrappleapis
    shortNames:
      - xapi
      - xapis
      - xgrapi
      - xgrapis
      - xgrplapi
      - xgrplapis
      - xgrappleapi
      - xgrappleapis
  versions:
    - name: v1alpha1
      served: true
      referenceable: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                name:
                  type: string
                asname:
                  type: string
                grapiversion:
                  description: 'Please specify here the version of grapi'
                  type: string
                clusterdomain:
                  description: 'Please specify here the clusterdomain of the target cluster'
                  type: string
                ingress:
                  description: 'Please specify here if ingress shall be enabled for the deployment'
                  type: boolean
                ssl:
                  description: 'Please specify here if ssl shall be configured for the deployment'
                  type: boolean
                sslissuer:
                  description: 'Please specify here the ssl issuer'
                  type: string
                disableexplorer:
                  description: 'Please specify "true" if you want to disable the explorer (default: false)'
                  type: boolean
                customheader:
                  description: 'Please specify here the custom header content protecting the grapi'
                  type: string
                corsurls:
                  description: 'Please specify here the allowed cors urls for protecting the grapi (e.g. "http://localhost:3000,http://localhost:2000")'
                  type: string
                auth:
                  description: 'Please specify here if authentication shall be enabled for the deployment (default: false)'
                  type: boolean
                auth_write_only:
                  description: 'Please specify here if authentication shall be enabled for write only endpoints (default: false)'
                  type: boolean
                buildimages:
                  description: 'Shall images be built (pre-baked) for this deployment?'
                  type: boolean
                buildimagecache:
                  description: 'Shall a cache be used for building the images?'
                  type: boolean
                runimages:
                  description: 'Shall the deployment be run directly?'
                  type: boolean
                deployimages:
                  description: 'Shall the (pre-baked) images be deployed? (if an imagetag is specified)'
                  type: boolean
                imagetag:
                  description: 'Please specify here the imagetag that shall be deployed'
                  type: string
                beimage:
                  description: 'Please specify here the image repository for the backend'
                  type: string
                beimagetag:
                  description: 'Please specify here the image tag for the backend'
                  type: string
                # uiimage:
                #   description: 'Please specify here the image repository for the ui modules'
                #   type: string
                # uiimagetag:
                #   description: 'Please specify here the image tag for the ui modules'
                #   type: string
                # uimodules:
                #   description: 'Please specify whether to deploy ui modules or only the be (api)'
                #   type: boolean
                translations:
                  description: 'Please specify whether translations shall be enabled'
                  type: boolean
                apiregistry:
                  description: 'Please specify whether apiregistry shall be enabled'
                  type: boolean
                graphql:
                  description: 'Please specify whether to deploy a graphql interface for the api'
                  type: boolean
                monitoring:
                  description: 'Please specify whether monitoring should be enabled'
                  type: boolean
                discoveredrepos:
                  description: 'Please specify whether to automatically discover the repositories'
                  type: boolean
                externalsecrets:
                  description: 'Please add here the externalsecrets for this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      spec:
                        description: please specify the spec for the externalsecrets - verify against kubectl get crd externalsecrets.external-secrets.io -o yaml
                        type: object
                        # allows to specify anything in the object... no verification whatsoever...
                        x-kubernetes-preserve-unknown-fields: true
                datasources:
                  description: 'Please add here the link to all the datasources that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          mysql:
                            description: specs for datasource type mysql
                            type: object
                            properties:
                              name:
                                description: please provide a name for the datasource
                                type: string
                              connector:
                                description: please provide the connector type for the datasource
                                type: string
                                default: mysql
                              database:
                                description: spec for database for datasource mysql
                                type: string
                              host:
                                description: spec for host for datasource mysql
                                type: string
                              password:
                                description: spec for password for datasource mysql
                                type: string
                              port:
                                description: spec for port for datasource mysql
                                type: string
                              url:
                                description: spec for url for datasource mysql
                                type: string
                              user:
                                description: spec for user for datasource mysql
                                type: string
                          postgresql:
                            description: specs for datasource type postgresql
                            type: object
                            properties:
                              name:
                                description: please provide a name for the datasource
                                type: string
                              connector:
                                description: please provide the connector type for the datasource
                                type: string
                                default: postgresql
                              database:
                                description: spec for database for datasource postgresql
                                type: string
                              host:
                                description: spec for host for datasource postgresql
                                type: string
                              password:
                                description: spec for password for datasource postgresql
                                type: string
                              port:
                                description: spec for port for datasource postgresql
                                type: string
                              url:
                                description: spec for url for datasource postgresql
                                type: string
                              user:
                                description: spec for user for datasource postgresql
                                type: string
                          kv-redis:
                            description: specs for datasource type kv-redis
                            type: object
                            properties:
                              name:
                                description: please provide a name for the datasource
                                type: string
                              connector:
                                description: please provide the connector type for the datasource
                                type: string
                                default: kv-redis
                              db:
                                description: spec for db for datasource kv-redis
                                type: string
                              host:
                                description: spec for host for datasource kv-redis
                                type: string
                              password:
                                description: spec for password for datasource kv-redis
                                type: string
                              port:
                                description: spec for port for datasource kv-redis
                                type: string
                              url:
                                description: spec for url for datasource kv-redis
                                type: string
                          kv-memory:
                            description: specs for datasource type kv-memory
                            type: object
                            properties:
                              name:
                                description: please provide a name for the datasource
                                type: string
                              connector:
                                description: please provide the connector type for the datasource
                                type: string
                                default: kv-memory
                          memory:
                            description: specs for datasource type memory
                            type: object
                            properties:
                              name:
                                description: please provide a name for the datasource
                                type: string
                              connector:
                                description: please provide the connector type for the datasource
                                type: string
                                default: memory
                              file:
                                description: spec for file for datasource memory
                                type: string
                              localStorage:
                                description: spec for localStorage for datasource memory
                                type: string
                discoveries:
                  description: 'Please add here the link to all the discoveries that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          dataSource:
                            description: The name of the datasource to discover
                            type: string
                          views:
                            description: Boolean to discover views
                            type: boolean
                          relations:
                            description: Discover and create relations
                            type: boolean
                          schema:
                            description: Schema to discover
                            type: string
                          all:
                            description: Discover all models without prompting users to select
                            type: boolean
                          outDir:
                            description: Specify the directory into which the `model.model.ts` files will be placed
                            type: string
                          models:
                            description: Discover specific models without prompting users to select e.g:--models=table1,table2
                            type: string
                          optionalId:
                            description: Boolean to mark id property as optional field
                            type: boolean
                          disableCamelCase:
                            description: disableCamelCase
                            type: boolean
                models:
                  description: 'Please add here the link to all the models that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          base:
                            description: A valid based model
                            type: string
                          dataSource:
                            description: The name of the dataSource which contains this model and suppots model discovery
                            type: string
                          table:
                            description: If discovering a model from a dataSource, specify the name of its table/view
                            type: string
                          schema:
                            description: If discovering a model from a dataSource, specify the schema which contains it
                            type: string
                          name:
                            description: name
                            type: string
                          properties:
                            description: properties
                            type: object
                            additionalProperties:
                              type: object
                              properties:
                                type:
                                  description: type
                                  type: string
                                itemType:
                                  description: itemType
                                  type: string
                                id:
                                  description: id
                                  type: boolean
                                generated:
                                  description: generated
                                  type: boolean
                                required:
                                  description: required
                                  type: boolean
                                default:
                                  description: default
                                  type: string
                relations:
                  description: 'Please add here the link to all the relations that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          relationType:
                            description: Relation type
                            type: string
                          sourceModel:
                            description: Source model
                            type: string
                          customReferenceKeys:
                            description: Destination model key
                            type: string
                          destinationModel:
                            description: Destination model key
                            type: string
                          throughModel:
                            description: Through model
                            type: string
                          sourceModelPrimaryKey:
                            description: Primary key on source model
                            type: string
                          sourceModelPrimaryKeyType:
                            description: Type of the primary key on source model
                            type: string
                          destinationModelPrimaryKey:
                            description: Primary key on destination model
                            type: string
                          destinationModelPrimaryKeyType:
                            description: Type of the primary key on destination model
                            type: string
                          sourceKeyOnThrough:
                            description: Foreign key references source model on through model
                            type: string
                          targetKeyOnThrough:
                            description: Foreign key references target model on through model
                            type: string
                          defaultForeignKeyName:
                            description: default foreign key name
                            type: string
                          foreignKeyName:
                            description: Destination model foreign key name (optional, provide only when there is a custom foreign key)
                            type: string
                          relationName:
                            description: Relation name
                            type: string
                          defaultRelationName:
                            description: Default relation name
                            type: string
                          registerInclusionResolver:
                            description: Allow <sourceModel> queries to include data from related <destinationModel>
                            type: boolean
                serviceproviders:
                  description: 'Please add here the link to all the serviceproviders that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          serviceprovidersproperty:
                            description: serviceprovidersproperty
                            type: string
                openapis:
                  description: 'Please add here the link to all the openapis that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          url:
                            description: URL or file path of the OpenAPI spec
                            type: string
                          validate:
                            description: Validate the OpenAPI spec
                            type: boolean
                          server:
                            description: Generate server-side controllers for the OpenAPI spec
                            type: boolean
                          client:
                            description: Generate client-side service proxies for the OpenAPI spec
                            type: boolean
                          datasource:
                            description: A valid datasource name for the OpenAPI endpoint
                            type: string
                          baseModel:
                            description: Base model class
                            type: string
                          promote-anonymous-schemas:
                            description: Promote anonymous schemas as models
                            type: boolean
                          prefix:
                            description: Provide prefix to avoid duplication
                            type: string
                cacheconfigs:
                  description: 'Please specify the configuration of a cache'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          redisDS:
                            description: Please specify here the name of the cache datasource (kv-redis datasource) to be used as cache storage
                            type: string
                          cacheTTL:
                            description: Please specify here the cache TTL for the cache storage
                            type: integer
                          openApis:
                            description: Please specify here the name of the openapi specification that shall be cached
                            type: string
                restcruds:
                  description: 'Please add here the link to all the restcruds that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          model:
                            description: A valid model name
                            type: string
                          datasource:
                            description: A valid datasource name
                            type: string
                          basePath:
                            description: A valid base path
                            type: string
                          readonly:
                            description: Create readonly APIs
                            type: boolean
                repositories:
                  description: 'Please add here the link to all the repositories that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          model:
                            description: A valid model name
                            type: string
                          id:
                            description: A valid ID property name for the specified model
                            type: string
                          datasource:
                            description: A valid datasource name
                            type: string
                          repositoryBaseClass:
                            description: A valid repository base class
                            type: string
                controllers:
                  description: 'Please add here the link to all the controllers that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          controllerType:
                            description: Type for the %s
                            type: string
                fuzzysearch:
                  description: 'Please specify the configuration of a cache'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          fuzzy:
                            description: Please specify here if a fuzzy search should be made available for each endpoint
                            type: boolean
                            default: true
                          centralFuzzy:
                            description: Please specify here if a central fuzzy endpoint over all endpoints shall be made available
                            type: boolean
                            default: false
                          datasource:
                            description: Please specify here the name of the datasource for which the fuzzy search endpoint shall be generated
                            type: string
                          appName:
                            description: Please specify here the application name for the fuzzy endpoint
                            type: string
                prepatches:
                  description: 'Please add here a patch script (base64 encoded) that shall run before datasource creation'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                prediscoverypatches:
                  description: 'Please add here a patch script (base64 encoded) that shall run before datasource discovery'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                prerelationpatches:
                  description: 'Please add here a patch script (base64 encoded) that shall run before relation creation'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                postpatches:
                  description: 'Please add here a patch script (base64 encoded) that shall run after backend creation'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                services:
                  description: 'Please add here the link to all the services that shall be deployed within this grapi'
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        description: please specify the name for the object
                        type: string
                      content:
                        description: please specify the content for the object
                        type: string
                      spec:
                        type: object
                        properties:
                          type:
                            description: Service type - proxy, class or provider
                            type: string
                          datasource:
                            description: A valid datasource name
                            type: string
# ### settings for the UI
# # openapi:
# #   description: 'Please specify here the url for the openapi specification'
# #   type: string
# # endpoint:
# #   description: 'Please specify here the endpoint for the openapi service'
# #   type: string
# style:
#   description: 'Please specify here the style for the ui modules'
#   type: string
# config:
#   description: 'Please specify here the config for the ui modules'
#   type: string
# additionalpackages:
#   description: 'Please specify here the additional packags that need to be installed for the ui modules'
#   type: string
# custommodules:
#   description: 'Please add here base64 encoded custom modules that shall be injected into'
#   type: array
#   items:
#     type: object
#     properties:
#       name:
#         description: please specify the name for the custom ui modules
#         type: string
#       content:
#         description: please specify the content/code for the custom ui modules
#         type: string
# required:
#   - id
