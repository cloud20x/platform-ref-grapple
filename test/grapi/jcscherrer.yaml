apiVersion: grsf.grpl.io/v1alpha1
kind: GrappleApi
metadata:
  name: jcscherrer
spec:
  name: jcscherrer
  clusterdomain: uat.cloud20x.com
  grapiversion: 1.0.0
  buildimagecache: false
  buildimages: true
  runimages: true
  deployimages: false
  graphql: true
  ssl: false
  sslissuer: letsencrypt-prod-cloud20x
  externalsecrets:
  - name: classicmodelsas-auroramysql
    spec:
      dataFrom:
      - extract:
          key: cloud20x/rds/auroramysql
      refreshInterval: 1h
      secretStoreRef:
        kind: ClusterSecretStore
        name: aws-secretstore
      target:
        creationPolicy: Owner
        name: auroramysql
  - name: jcscherrer-bexio
    spec:
      dataFrom:
      - extract:
          key: cloud20x/jcscherrer/bexionop
      refreshInterval: 1h
      secretStoreRef:
        kind: ClusterSecretStore
        name: aws-secretstore
      target:
        creationPolicy: Owner
        name: jcscherrer-bexio
  datasources:
  - content: '{ "name": "jcscherrer", "connector": "mysql", "url": "", "host": "${host}",
      "port": "${port}", "user": "${username}", "password": "${password}", "database":
      "jcscherrer"}'
    name: jcscherrer
  discoveries:
  - content: '{"dataSource":"jcscherrer","schema":"jcscherrer","all":"true","disableCamelCase":false}'
    name: jcscherrer
  relations:
  - content: '{"sourceModel": "Rapport", "destinationModel": "Trainer", "foreignKeyName":
      "trainerId", "relationType": "belongsTo", "registerInclusionResolver": true}'
    name: trainer
  - content: '{"sourceModel": "Rapport", "destinationModel": "Platz", "foreignKeyName":
      "platzId", "relationType": "belongsTo", "registerInclusionResolver": true}'
    name: platz
  - content: '{"sourceModel": "Rapport", "destinationModel": "Kunde", "foreignKeyName":
      "kundeId", "relationType": "belongsTo", "registerInclusionResolver": true}'
    name: kunde
  - content: '{"sourceModel": "Rapport", "destinationModel": "Gruppe", "foreignKeyName":
      "gruppeId", "relationType": "belongsTo", "registerInclusionResolver": true}'
    name: gruppe
  restcruds:
  - content: '{"datasource":"jcscherrer"}'
    name: jcscherrer
  controllers:
  - content: Ly8gQHRzLW5vY2hlY2sKLy8gVW5jb21tZW50IHRoZXNlIGltcG9ydHMgdG8gYmVnaW4gdXNpbmcgdGhlc2UgY29vbCBmZWF0dXJlcyEKCmltcG9ydCB7IGluamVjdCB9IGZyb20gIkBsb29wYmFjay9jb3JlIjsKaW1wb3J0IHsKICBIdHRwRXJyb3JzLAogIHBvc3QsCiAgUmVxdWVzdCwKICByZXF1ZXN0Qm9keSwKICBSZXN0QmluZGluZ3MsCn0gZnJvbSAiQGxvb3BiYWNrL3Jlc3QiOwoKY29uc3QgaHR0cHMgPSByZXF1aXJlKCJodHRwcyIpOwoKY29uc3QgYmV4aW9Ub2tlbiA9IHByb2Nlc3MuZW52WyJCRVhJT19UT0tFTiJdIHx8ICIiOwpjb25zdCBiZXhpb1Byb2ZpbGUgPSBwcm9jZXNzLmVudlsiQkVYSU9fUFJPRklMRSJdIHx8ICJkZWZhdWx0IjsKY29uc3QgYmV4aW9VcmwgPSBwcm9jZXNzLmVudlsiQkVYSU9fQVBJX1VSTCJdIHx8ICJodHRwczovL2FwaS5iZXhpby5jb20vMi4wIjsKCmFzeW5jIGZ1bmN0aW9uIHBvc3RSZXF1ZXN0KHVybCwgZGF0YSkgewogIGNvbnN0IGRhdGFTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKCiAgY29uc3Qgb3B0aW9ucyA9IHsKICAgIG1ldGhvZDogIlBPU1QiLAogICAgaGVhZGVyczogewogICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICBBY2NlcHQ6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2JleGlvVG9rZW59YCwKICAgIH0sCiAgICB0aW1lb3V0OiAwLCAvLyBpbiBtcwogIH07CgogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICBjb25zdCByZXEgPSBodHRwcy5yZXF1ZXN0KHVybCwgb3B0aW9ucywgKHJlcykgPT4gewogICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPCAyMDAgfHwgcmVzLnN0YXR1c0NvZGUgPiAyOTkpIHsKICAgICAgICByZXR1cm4gcmVqZWN0KHsgc3RhdHVzQ29kZTogcmVzLnN0YXR1c0NvZGUsIG1lc3NhZ2U6ICJlcnJvciIgfSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGJvZHkgPSBbXTsKICAgICAgcmVzLm9uKCJkYXRhIiwgKGNodW5rKSA9PiBib2R5LnB1c2goY2h1bmspKTsKICAgICAgcmVzLm9uKCJlbmQiLCAoKSA9PiB7CiAgICAgICAgY29uc3QgcmVzU3RyaW5nID0gQnVmZmVyLmNvbmNhdChib2R5KS50b1N0cmluZygpOwogICAgICAgIHJlc29sdmUocmVzU3RyaW5nKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICByZXEub24oImVycm9yIiwgKGVycikgPT4gewogICAgICByZWplY3QoZXJyKTsKICAgIH0pOwoKICAgIHJlcS5vbigidGltZW91dCIsICgpID0+IHsKICAgICAgcmVxLmRlc3Ryb3koKTsKICAgICAgcmVqZWN0KG5ldyBFcnJvcigiUmVxdWVzdCB0aW1lIG91dCIpKTsKICAgIH0pOwoKICAgIHJlcS53cml0ZShkYXRhU3RyaW5nKTsKICAgIHJlcS5lbmQoKTsKICB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gZGVsZXRlUmVxdWVzdCh1cmwpIHsKICBjb25zdCBvcHRpb25zID0gewogICAgbWV0aG9kOiAiREVMRVRFIiwKICAgIGhlYWRlcnM6IHsKICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgQWNjZXB0OiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtiZXhpb1Rva2VufWAsCiAgICB9LAogICAgdGltZW91dDogMCwgLy8gaW4gbXMKICB9OwogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICBjb25zdCByZXEgPSBodHRwcy5yZXF1ZXN0KHVybCwgb3B0aW9ucywgKHJlcykgPT4gewogICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPCAyMDAgfHwgcmVzLnN0YXR1c0NvZGUgPiAyOTkpIHsKICAgICAgICByZXR1cm4gcmVqZWN0KHsgc3RhdHVzQ29kZTogcmVzLnN0YXR1c0NvZGUsIG1lc3NhZ2U6ICJlcnJvciIgfSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGJvZHkgPSBbXTsKICAgICAgcmVzLm9uKCJkYXRhIiwgKGNodW5rKSA9PiBib2R5LnB1c2goY2h1bmspKTsKICAgICAgcmVzLm9uKCJlbmQiLCAoKSA9PiB7CiAgICAgICAgY29uc3QgcmVzU3RyaW5nID0gQnVmZmVyLmNvbmNhdChib2R5KS50b1N0cmluZygpOwogICAgICAgIHJlc29sdmUocmVzU3RyaW5nKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICByZXEub24oImVycm9yIiwgKGVycikgPT4gewogICAgICByZWplY3QoZXJyKTsKICAgIH0pOwoKICAgIHJlcS5vbigidGltZW91dCIsICgpID0+IHsKICAgICAgcmVxLmRlc3Ryb3koKTsKICAgICAgcmVqZWN0KG5ldyBFcnJvcigiUmVxdWVzdCB0aW1lIG91dCIpKTsKICAgIH0pOwoKICAgIHJlcS53cml0ZSgiIik7CiAgICByZXEuZW5kKCk7CiAgfSk7Cn0KZXhwb3J0IGNsYXNzIEJleGlvQ29udHJvbGxlciB7CiAgY29uc3RydWN0b3IoQGluamVjdChSZXN0QmluZGluZ3MuSHR0cC5SRVFVRVNUKSBwcml2YXRlIHJlcTogUmVxdWVzdCkge30KCiAgLy8gTWFwIHRvIGBwb3N0IC9jcmVhdGUtYmV4aW8taW52b2ljZWAKICBAcG9zdCgiL2NyZWF0ZS1iZXhpby1pbnZvaWNlIikKICAvLyBAcmVzcG9uc2UoMjAwLCBQSU5HX1JFU1BPTlNFKQogIGFzeW5jIGNyZWF0ZUJleGlvSW52b2ljZShAcmVxdWVzdEJvZHkoKSBCZXhpb0JvZHk6IGFueSk6IFByb21pc2U8b2JqZWN0PiB7CiAgICBjb25zb2xlLmxvZygiaW4gcmVxdWVzdCIpOwogICAgY29uc29sZS5sb2coeyBCZXhpb0JvZHkgfSk7CiAgICAvLyBSZXBseSB3aXRoIGEgZ3JlZXRpbmcsIHRoZSBjdXJyZW50IHRpbWUsIHRoZSB1cmwsIGFuZCByZXF1ZXN0IGhlYWRlcnMKICAgIGNvbnN0IHsgaW52b2ljZVRpdGxlRGF0ZSwgZ3JvdXAsIG1pbkRhdGUsIG1heERhdGUgfSA9IEJleGlvQm9keTsKCiAgICB0cnkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCBwb3N0UmVxdWVzdChgJHtiZXhpb1VybH0va2JfaW52b2ljZWAsIHsKICAgICAgICB0aXRsZTogYCR7aW52b2ljZVRpdGxlRGF0ZX0tJHtncm91cC5rdW5kZS52b3JuYW1lfSAke2dyb3VwLmt1bmRlLm5hbWV9YCwKICAgICAgICBjb250YWN0X2lkOiBiZXhpb1Byb2ZpbGUgPT09ICJub3AiID8gMiA6IGdyb3VwLmt1bmRlLmJleGlvSWQsCiAgICAgICAgdXNlcl9pZDogYmV4aW9Qcm9maWxlID09PSAibm9wIiA/IDEgOiA5LAogICAgICAgIGJhbmtfYWNjb3VudF9pZDogMSwKICAgICAgICBoZWFkZXI6CiAgICAgICAgICAiU2VociBnZWVocnRlIERhbWVuIHVuZCBIZXJyZW48YnIgLz48YnIgLz5XaXIgZXJsYXViZW4gdW5zLCBJaG5lbiB3aWUgZm9sZ3QgaW4gUmVjaG51bmcgenUgc3RlbGxlbjoiLAogICAgICAgIGZvb3RlcjoKICAgICAgICAgICJQUklWQVRMRUtUSU9ORU46PGJyIC8+QmVpIFZlcmhpbmRlcnVuZyBiaXR0ZW4gd2lyIHVtIGVpbmUgc2NocmlmdGxpY2hlIEFic2FnZSBwZXIgTWFpbCAoa2VpbmUgU01TISkgbWluZGVzdGVucyAyNGggaW0gdm9yYXVzIGFuOiBzY2hvb2xAamNzY2hlcnJlci5jb20uIFdpcmQgZGllcyBuaWNodCBiZXImdXVtbDtja3NpY2h0aWd0LCB3aXJkIGRlciBnZWJ1Y2h0ZSBUZW5uaXN1bnRlcnJpY2h0IGluIFJlY2hudW5nIGdlc3RlbGx0LiA8YnIgLz48YnIgLz48YnIgLz5GcmV1bmRsaWNoZSBHciZ1dW1sO3NzZSIsCiAgICAgICAgbXdzdF90eXBlOiAyLAogICAgICAgIG13c3RfaXNfbmV0OiB0cnVlLAogICAgICAgIHNob3dfcG9zaXRpb25fdGF4ZXM6IGZhbHNlLAogICAgICAgIGlzX3ZhbGlkX2Zyb206IG1pbkRhdGUsCiAgICAgICAgaXNfdmFsaWRfdG86IG1heERhdGUsCiAgICAgICAgcG9zaXRpb25zOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIGFtb3VudDogZ3JvdXAucmFwcG9ydHMubGVuZ3RoLAogICAgICAgICAgICB0YXhfaWQ6IDMsCiAgICAgICAgICAgIHRleHQ6IGBQcml2YXRzdHVuZGVuIC0gJHtpbnZvaWNlVGl0bGVEYXRlfSAtICR7Z3JvdXAua3VuZGUudm9ybmFtZX0gJHtncm91cC5rdW5kZS5uYW1lfWAsCiAgICAgICAgICAgIHVuaXRfcHJpY2U6ICIxMzAiLAogICAgICAgICAgICBhcnRpY2xlX2lkOiBiZXhpb1Byb2ZpbGUgPT09ICJub3AiID8gMSA6IDE2LAogICAgICAgICAgICB0eXBlOiAiS2JQb3NpdGlvbkFydGljbGUiLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICB9KTsKCiAgICAgIHJldHVybiByZXM7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICB0aHJvdyBuZXcgSHR0cEVycm9yc1tlLnN0YXR1c0NvZGVdKCIiKTsKICAgIH0KICB9CgogIC8vIE1hcCB0byBgcG9zdCAvZGVsZXRlLWJleGlvLWludm9pY2VgCiAgQHBvc3QoIi9kZWxldGUtYmV4aW8taW52b2ljZSIpCiAgLy8gQHJlc3BvbnNlKDIwMCwgUElOR19SRVNQT05TRSkKICBhc3luYyBkZWxldGVCZXhpb0ludm9pY2UoQHJlcXVlc3RCb2R5KCkgQmV4aW9Cb2R5OiBhbnkpOiBQcm9taXNlPG9iamVjdD4gewogICAgY29uc29sZS5sb2coImluIHJlcXVlc3QiKTsKICAgIGNvbnNvbGUubG9nKHsgQmV4aW9Cb2R5IH0pOwogICAgLy8gUmVwbHkgd2l0aCBhIGdyZWV0aW5nLCB0aGUgY3VycmVudCB0aW1lLCB0aGUgdXJsLCBhbmQgcmVxdWVzdCBoZWFkZXJzCiAgICBjb25zdCB7IGludm9pY2VJZCB9ID0gQmV4aW9Cb2R5OwoKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRlbGV0ZVJlcXVlc3QoYCR7YmV4aW9Vcmx9L2tiX2ludm9pY2UvJHtpbnZvaWNlSWR9YCk7CiAgICAgIGNvbnNvbGUubG9nKHJlcyk7CiAgICAgIHJldHVybiByZXM7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICB0aHJvdyBuZXcgSHR0cEVycm9yc1tlLnN0YXR1c0NvZGVdKCIiKTsKICAgIH0KICB9Cn0K
    name: bexio
